<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Frontend Monitor SDK - Vanilla JS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .app-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .status-bar {
            padding: 15px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-dot.active {
            background: #10b981;
        }

        .status-dot.inactive {
            background: #6b7280;
        }

        .status-dot.error {
            background: #ef4444;
        }

        .main-content {
            padding: 40px;
        }

        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }

        .section h2 {
            color: #1f2937;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h2::before {
            content: '';
            width: 4px;
            height: 24px;
            background: #6366f1;
            border-radius: 2px;
        }

        .user-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #10b981;
        }

        .user-info h3 {
            color: #059669;
            margin-bottom: 10px;
        }

        .user-info p {
            margin: 5px 0;
            color: #6b7280;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #374151;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }

        .metric-card:hover {
            transform: translateY(-4px);
        }

        .metric-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.875rem;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-trend {
            font-size: 0.75rem;
            margin-top: 5px;
            padding: 2px 8px;
            border-radius: 12px;
            background: #f0fdf4;
            color: #166534;
        }

        .metric-trend.down {
            background: #fef2f2;
            color: #dc2626;
        }

        .custom-metrics-list {
            background: white;
            border-radius: 8px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .metric-item:last-child {
            border-bottom: none;
        }

        .metric-info {
            display: flex;
            flex-direction: column;
        }

        .metric-name {
            font-weight: 600;
            color: #1f2937;
        }

        .metric-type {
            font-size: 0.75rem;
            color: #6b7280;
            text-transform: uppercase;
        }

        .metric-value-display {
            font-weight: 700;
            color: #6366f1;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
        }

        .alert-error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
        }

        .alert-info {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            color: #0369a1;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .mini-chart {
            height: 100px;
            background: linear-gradient(to right, #f0f9ff, #e0f2fe);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            color: #0369a1;
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-in {
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .main-content {
                padding: 20px;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="app-container">
            <!-- Header -->
            <header class="header">
                <h1>üöÄ Enhanced Monitor SDK</h1>
                <p>Advanced Frontend Monitoring with Vanilla JavaScript</p>
            </header>

            <!-- Status Bar -->
            <div class="status-bar">
                <div class="status-indicator">
                    <div id="status-dot" class="status-dot inactive"></div>
                    <span id="status-text">Initializing...</span>
                </div>
                <div>
                    <span id="connection-status">üî¥ Not Connected</span>
                </div>
            </div>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Alert Section -->
                <div id="alert-container"></div>

                <!-- User Section -->
                <div id="user-section" class="section hidden">
                    <h2>üë§ User Information</h2>
                    <div id="user-info" class="user-info"></div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="profile-name">Update Name</label>
                            <input type="text" id="profile-name" class="form-control" placeholder="Enter new name">
                        </div>
                    </div>

                    <div class="btn-group">
                        <button onclick="updateProfile()" class="btn btn-success">
                            üíæ Update Profile
                        </button>
                        <button onclick="logout()" class="btn btn-danger">
                            üö™ Logout
                        </button>
                    </div>
                </div>

                <!-- Login Section -->
                <div id="login-section" class="section">
                    <h2>üîê Authentication</h2>
                    <p style="margin-bottom: 20px; color: #6b7280;">
                        Click the button below to simulate user login and see monitoring in action.
                    </p>
                    <button onclick="handleLogin()" id="login-btn" class="btn btn-primary">
                        üöÄ Login to Application
                    </button>
                </div>

                <!-- Test Operations Section -->
                <div class="section">
                    <h2>üß™ Test Operations</h2>
                    <p style="margin-bottom: 20px; color: #6b7280;">
                        Test different types of operations with automatic monitoring
                    </p>

                    <div class="btn-group">
                        <button onclick="handleSuccessOperation()" class="btn btn-success">
                            ‚úÖ Success Operation
                        </button>
                        <button onclick="handleErrorOperation()" class="btn btn-danger">
                            ‚ùå Trigger Error
                        </button>
                        <button onclick="handleAsyncOperation()" class="btn btn-warning">
                            ‚è≥ Async Operation
                        </button>
                        <button onclick="handleComplexWorkflow()" class="btn btn-info">
                            üîó Complex Workflow
                        </button>
                    </div>
                </div>

                <!-- Performance Metrics Section -->
                <div class="section">
                    <h2>üìä Performance Metrics</h2>
                    <div class="metrics-grid" id="performance-metrics">
                        <div class="metric-card">
                            <div class="metric-icon">‚ö°</div>
                            <div class="metric-value" id="metric-fcp">-</div>
                            <div class="metric-label">FCP</div>
                            <div class="metric-trend" id="trend-fcp">First Contentful Paint</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">üéØ</div>
                            <div class="metric-value" id="metric-lcp">-</div>
                            <div class="metric-label">LCP</div>
                            <div class="metric-trend" id="trend-lcp">Largest Contentful Paint</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">üëÜ</div>
                            <div class="metric-value" id="metric-fid">-</div>
                            <div class="metric-label">FID</div>
                            <div class="metric-trend" id="trend-fid">First Input Delay</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">üìà</div>
                            <div class="metric-value" id="metric-cls">-</div>
                            <div class="metric-label">CLS</div>
                            <div class="metric-trend" id="trend-cls">Cumulative Layout Shift</div>
                        </div>
                    </div>

                    <button onclick="refreshPerformanceMetrics()" class="btn btn-primary">
                        üîÑ Refresh Metrics
                    </button>
                </div>

                <!-- Custom Metrics Section -->
                <div class="section">
                    <h2>üìà Custom Metrics</h2>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="metric-value">Value</label>
                            <input type="number" id="metric-value" class="form-control" value="100" min="0">
                        </div>
                        <div class="form-group">
                            <label for="metric-label">Label</label>
                            <input type="text" id="metric-label" class="form-control" value="user_engagement" placeholder="Enter metric label">
                        </div>
                        <div class="form-group">
                            <label for="metric-type">Type</label>
                            <select id="metric-type" class="form-control">
                                <option value="histogram">Histogram</option>
                                <option value="counter">Counter</option>
                                <option value="gauge">Gauge</option>
                            </select>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button onclick="addCustomMetric()" class="btn btn-primary">
                            ‚ûï Add Metric
                        </button>
                        <button onclick="incrementCounter()" class="btn btn-success">
                            üìä Increment Counter
                        </button>
                        <button onclick="clearMetrics()" class="btn btn-warning">
                            üóëÔ∏è Clear All
                        </button>
                    </div>

                    <div class="custom-metrics-list" id="custom-metrics-list">
                        <p style="text-align: center; color: #9ca3af;">
                            No custom metrics recorded yet
                        </p>
                    </div>
                </div>

                <!-- Real-time Monitoring -->
                <div class="section">
                    <h2>üì° Real-time Monitoring</h2>
                    <div class="chart-container">
                        <h4 style="margin-bottom: 10px;">Activity Timeline</h4>
                        <div class="mini-chart" id="activity-chart">
                            Real-time activity will appear here...
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <h4 style="margin-bottom: 10px;">üìä Statistics</h4>
                            <div id="statistics">
                                <div>Operations: <strong id="stat-operations">0</strong></div>
                                <div>Errors: <strong id="stat-errors">0</strong></div>
                                <div>Metrics: <strong id="stat-metrics">0</strong></div>
                            </div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <h4 style="margin-bottom: 10px;">‚è±Ô∏è Session Info</h4>
                            <div id="session-info">
                                <div>Duration: <strong id="session-duration">0s</strong></div>
                                <div>Page Views: <strong id="page-views">1</strong></div>
                                <div>User Agent: <strong id="user-agent">-</strong></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Monitor Info -->
                <div class="section">
                    <h2>‚ÑπÔ∏è Monitor Information</h2>
                    <div style="background: #f0f9ff; padding: 20px; border-radius: 8px; border-left: 4px solid #3b82f6;">
                        <h4 style="margin-bottom: 10px; color: #1e40af;">How to Monitor:</h4>
                        <ul style="margin: 0; padding-left: 20px; color: #3730a3;">
                            <li><strong>Network Tab:</strong> Check for OTLP requests to your collector</li>
                            <li><strong>Console:</strong> View SDK logs and debug information</li>
                            <li><strong>Performance Tab:</strong> See performance metrics collection</li>
                            <li><strong>Collector:</strong> Monitor traces and metrics at your endpoint</li>
                        </ul>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- SDK Script -->
    <script src="../dist/index.umd.js"></script>

    <script>
        // Global state
        let monitor;
        let currentUser = null;
        let statistics = {
            operations: 0,
            errors: 0,
            metrics: 0
        };
        let sessionStartTime = Date.now();
        let activityLog = [];
        let customMetricsData = [];

        // Initialize monitor
        async function initializeMonitor() {
            try {
                updateStatus('Initializing SDK...', 'info');

                monitor = FrontendMonitorSDK.createFrontendMonitor();

                await monitor.init({
                    serviceName: 'vanilla-js-enhanced',
                    serviceVersion: '2.0.0',
                    endpoint: 'https://your-collector.example.com',
                    apiKey: 'your-api-key',
                    sampleRate: 1.0,
                    enablePerformanceMonitoring: true,
                    enableErrorMonitoring: true,
                    enableUserInteractionMonitoring: true,
                    enableAutoTracing: true,
                    enableCustomMetrics: true,
                    attributes: {
                        framework: 'vanilla-js',
                        environment: 'enhanced-demo',
                        browser: navigator.userAgent.split(' ')[0],
                        language: navigator.language,
                        screen_resolution: `${screen.width}x${screen.height}`
                    },
                    excludedUrls: [
                        '*/analytics/*',
                        '*/tracking/*',
                        '*/ads/*'
                    ]
                });

                updateStatus('‚úÖ Monitor SDK initialized successfully', 'success');
                updateConnectionStatus('üü¢ Connected');
                logActivity('SDK initialized', 'system');

                // Start session monitoring
                startSessionMonitoring();

                // Setup global error handling
                setupGlobalErrorHandling();

                // Update user agent display
                updateUserAgent();

            } catch (error) {
                const errorMessage = error instanceof Error ? error.message : 'Unknown error';
                updateStatus(`‚ùå Failed to initialize: ${errorMessage}`, 'error');
                updateConnectionStatus('üî¥ Connection Failed');
                logActivity(`Initialization failed: ${errorMessage}`, 'error');
            }
        }

        // Status management
        function updateStatus(message, type = 'info') {
            const statusText = document.getElementById('status-text');
            const statusDot = document.getElementById('status-dot');

            statusText.textContent = message;
            statusDot.className = `status-dot ${type}`;

            // Add alert
            if (type === 'error') {
                showAlert(message, 'error');
            } else if (type === 'success') {
                logActivity(message, 'success');
            }
        }

        function updateConnectionStatus(status) {
            document.getElementById('connection-status').textContent = status;
        }

        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alert-container');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} fade-in`;

            const icon = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
            alertDiv.innerHTML = `${icon} ${message}`;

            alertContainer.appendChild(alertDiv);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                alertDiv.style.opacity = '0';
                setTimeout(() => alertDiv.remove(), 300);
            }, 5000);
        }

        // Activity logging
        function logActivity(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            activityLog.push({ timestamp, message, type });

            // Keep only last 50 activities
            if (activityLog.length > 50) {
                activityLog.shift();
            }

            updateActivityChart();
        }

        function updateActivityChart() {
            const chart = document.getElementById('activity-chart');
            const recentActivities = activityLog.slice(-5);

            if (recentActivities.length > 0) {
                chart.innerHTML = recentActivities
                    .map(activity => `${activity.timestamp} - ${activity.message}`)
                    .join('<br>');
            }
        }

        // Session monitoring
        function startSessionMonitoring() {
            setInterval(() => {
                const duration = Math.floor((Date.now() - sessionStartTime) / 1000);
                document.getElementById('session-duration').textContent = `${duration}s`;

                // Simulate page views change
                if (Math.random() > 0.95) {
                    incrementPageViews();
                }
            }, 1000);
        }

        function incrementPageViews() {
            const pageViewsElement = document.getElementById('page-views');
            const currentViews = parseInt(pageViewsElement.textContent) || 1;
            pageViewsElement.textContent = currentViews + 1;
            logActivity('Page view tracked', 'info');
        }

        function updateUserAgent() {
            const userAgentElement = document.getElementById('user-agent');
            userAgentElement.textContent = navigator.userAgent.split(' ')[0];
        }

        // Global error handling
        function setupGlobalErrorHandling() {
            window.addEventListener('error', (event) => {
                statistics.errors++;
                updateStatistics();
                logActivity(`Global error: ${event.message}`, 'error');
                showAlert(`JavaScript Error: ${event.message}`, 'error');
            });

            window.addEventListener('unhandledrejection', (event) => {
                statistics.errors++;
                updateStatistics();
                logActivity(`Unhandled rejection: ${event.reason}`, 'error');
                showAlert(`Promise Rejection: ${event.reason}`, 'error');
            });
        }

        // Statistics
        function updateStatistics() {
            document.getElementById('stat-operations').textContent = statistics.operations;
            document.getElementById('stat-errors').textContent = statistics.errors;
            document.getElementById('stat-metrics').textContent = statistics.metrics;
        }

        // User management
        function handleLogin() {
            const tracing = monitor.startTracing('user_login', {
                attributes: {
                    login_method: 'enhanced_vanilla',
                    timestamp: Date.now(),
                    session_id: generateSessionId()
                }
            });

            const loginBtn = document.getElementById('login-btn');
            loginBtn.disabled = true;
            loginBtn.textContent = 'üîÑ Logging in...';

            statistics.operations++;
            updateStatistics();
            logActivity('Login attempt started', 'info');

            setTimeout(() => {
                if (Math.random() > 0.15) { // 85% success rate
                    // Success path
                    currentUser = {
                        id: 'user_' + generateId(),
                        name: 'Enhanced User',
                        email: 'enhanced@example.com',
                        avatar: 'üë§',
                        joinDate: new Date().toISOString(),
                        lastLogin: new Date().toISOString()
                    };

                    const metrics = monitor.getMetricsCollector();
                    metrics.incrementCounter('user_logins_total', 1, {
                        status: 'success',
                        method: 'enhanced_vanilla',
                        user_type: 'premium'
                    });

                    metrics.recordHistogram('login_duration_ms', 1200, {
                        method: 'enhanced_vanilla',
                        browser: navigator.userAgent.split(' ')[0]
                    });

                    showUserSection();
                    tracing.endSpan();
                    updateStatus('‚úÖ Login successful!', 'success');
                    logActivity(`User logged in: ${currentUser.name}`, 'success');

                    // Show success animation
                    document.getElementById('user-section').classList.add('slide-in');

                } else {
                    // Error path
                    const error = new Error('Authentication failed: Invalid credentials');
                    tracing.recordError(error);
                    tracing.endSpan();

                    const metrics = monitor.getMetricsCollector();
                    metrics.incrementCounter('user_logins_total', 1, {
                        status: 'error',
                        error_type: 'invalid_credentials',
                        method: 'enhanced_vanilla'
                    });

                    statistics.errors++;
                    updateStatistics();
                    updateStatus('‚ùå Login failed: Invalid credentials', 'error');
                    logActivity('Login failed: Invalid credentials', 'error');
                }

                loginBtn.disabled = false;
                loginBtn.textContent = 'üöÄ Login to Application';
            }, 1500);
        }

        function showUserSection() {
            const loginSection = document.getElementById('login-section');
            const userSection = document.getElementById('user-section');

            loginSection.classList.add('hidden');
            userSection.classList.remove('hidden');

            const userInfo = document.getElementById('user-info');
            userInfo.innerHTML = `
                <h3>${currentUser.avatar} Welcome, ${currentUser.name}!</h3>
                <p><strong>ID:</strong> ${currentUser.id}</p>
                <p><strong>Email:</strong> ${currentUser.email}</p>
                <p><strong>Member Since:</strong> ${new Date(currentUser.joinDate).toLocaleDateString()}</p>
                <p><strong>Last Login:</strong> ${new Date(currentUser.lastLogin).toLocaleString()}</p>
            `;
        }

        function logout() {
            const tracing = monitor.startTracing('user_logout', {
                attributes: {
                    user_id: currentUser?.id,
                    session_duration: Date.now() - sessionStartTime
                }
            });

            currentUser = null;

            const metrics = monitor.getMetricsCollector();
            metrics.incrementCounter('user_logouts_total', 1, {
                user_id: currentUser?.id || 'unknown'
            });

            metrics.recordHistogram('session_duration_ms', Date.now() - sessionStartTime, {
                reason: 'logout'
            });

            document.getElementById('user-section').classList.add('hidden');
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('profile-name').value = '';

            tracing.endSpan();
            updateStatus('üëã Logged out successfully', 'info');
            logActivity('User logged out', 'info');
        }

        function updateProfile() {
            if (!monitor || !currentUser) return;

            const nameInput = document.getElementById('profile-name');
            const newName = nameInput.value.trim();

            if (!newName) {
                showAlert('Please enter a valid name', 'error');
                return;
            }

            const tracing = monitor.startTracing('profile_update', {
                attributes: {
                    user_id: currentUser.id,
                    update_field: 'name',
                    old_name: currentUser.name,
                    new_name: newName
                }
            });

            statistics.operations++;
            updateStatistics();
            logActivity(`Profile update started: ${currentUser.name} ‚Üí ${newName}`, 'info');

            setTimeout(() => {
                if (newName.length < 2) {
                    const error = new Error('Name must be at least 2 characters long');
                    tracing.recordError(error);
                    tracing.endSpan();

                    statistics.errors++;
                    updateStatistics();
                    showAlert(error.message, 'error');
                    logActivity(`Profile update failed: ${error.message}`, 'error');
                    return;
                }

                // Update user data
                currentUser.name = newName;
                currentUser.lastLogin = new Date().toISOString();

                const metrics = monitor.getMetricsCollector();
                metrics.incrementCounter('profile_updates_total', 1, {
                    status: 'success',
                    field: 'name'
                });

                metrics.recordHistogram('update_processing_time_ms', 500, {
                    operation: 'profile_update',
                    field: 'name'
                });

                // Update UI
                showUserSection();
                nameInput.value = '';

                tracing.endSpan();
                updateStatus('‚úÖ Profile updated successfully!', 'success');
                logActivity(`Profile updated: ${newName}`, 'success');
                showAlert('Profile updated successfully!', 'success');

            }, 500);
        }

        // Test operations
        function handleSuccessOperation() {
            const tracing = monitor.startTracing('success_operation', {
                attributes: {
                    operation_type: 'test',
                    complexity: 'simple',
                    user_id: currentUser?.id
                }
            });

            statistics.operations++;
            updateStatistics();
            logActivity('Success operation started', 'info');

            setTimeout(() => {
                const metrics = monitor.getMetricsCollector();
                metrics.incrementCounter('successful_operations_total', 1, {
                    operation: 'test',
                    framework: 'vanilla-js'
                });

                metrics.recordHistogram('operation_duration_ms', 300, {
                    operation: 'test',
                    complexity: 'simple'
                });

                metrics.recordGauge('system_health', 95, {
                    component: 'test_module'
                });

                tracing.endSpan();
                updateStatus('‚úÖ Success operation completed', 'success');
                logActivity('Success operation completed', 'success');

            }, 300);
        }

        function handleErrorOperation() {
            const tracing = monitor.startTracing('error_operation');

            statistics.operations++;
            updateStatistics();
            logActivity('Error operation triggered', 'warning');

            try {
                // Intentionally trigger an error
                throw new Error('This is a test error for demonstration purposes');
            } catch (error) {
                statistics.errors++;
                updateStatistics();

                monitor.recordError(error, {
                    operation: 'test_error',
                    user_action: 'trigger_error',
                    user_id: currentUser?.id || 'anonymous',
                    stack_trace: error.stack
                });

                tracing.recordError(error);
                tracing.endSpan();

                updateStatus('‚ùå Error recorded successfully', 'error');
                logActivity(`Test error recorded: ${error.message}`, 'error');
                showAlert(`Test Error: ${error.message}`, 'error');
            }
        }

        function handleAsyncOperation() {
            const tracing = monitor.startTracing('async_operation', {
                attributes: {
                    operation_type: 'test',
                    complexity: 'medium',
                    user_id: currentUser?.id
                }
            });

            statistics.operations++;
            updateStatistics();
            logActivity('Async operation started', 'info');

            // Simulate async API call with progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 20;
                if (progress <= 80) {
                    logActivity(`Operation progress: ${progress}%`, 'info');
                }
            }, 300);

            setTimeout(() => {
                clearInterval(progressInterval);

                // Simulate success/failure
                if (Math.random() > 0.25) { // 75% success rate
                    const metrics = monitor.getMetricsCollector();
                    metrics.incrementCounter('async_operations_total', 1, {
                        status: 'success',
                        duration: 'medium'
                    });

                    metrics.recordHistogram('async_response_time_ms', 1500, {
                        operation: 'test',
                        type: 'api_call'
                    });

                    tracing.endSpan();
                    updateStatus('‚úÖ Async operation completed successfully', 'success');
                    logActivity('Async operation succeeded', 'success');
                    showAlert('Async operation completed successfully!', 'success');

                } else {
                    const error = new Error('Async operation: Service temporarily unavailable');

                    statistics.errors++;
                    updateStatistics();

                    tracing.recordError(error);
                    tracing.endSpan();

                    const metrics = monitor.getMetricsCollector();
                    metrics.incrementCounter('async_operations_total', 1, {
                        status: 'error',
                        error_type: 'service_unavailable',
                        duration: 'medium'
                    });

                    updateStatus('‚ùå Async operation failed', 'error');
                    logActivity(`Async operation failed: ${error.message}`, 'error');
                    showAlert(`Async Operation Failed: ${error.message}`, 'error');
                }
            }, 2000);
        }

        function handleComplexWorkflow() {
            const tracing = monitor.startTracing('complex_workflow', {
                attributes: {
                    workflow_type: 'multi_step',
                    complexity: 'high',
                    user_id: currentUser?.id
                }
            });

            statistics.operations++;
            updateStatistics();
            logActivity('Complex workflow started', 'info');

            // Step 1: Data Validation
            setTimeout(() => {
                logActivity('Step 1: Validating data...', 'info');

                setTimeout(() => {
                    // Step 2: API Call
                    logActivity('Step 2: Calling external API...', 'info');

                    setTimeout(() => {
                        // Step 3: Data Processing
                        logActivity('Step 3: Processing data...', 'info');

                        setTimeout(() => {
                            // Step 4: Complete
                            const metrics = monitor.getMetricsCollector();
                            metrics.incrementCounter('complex_workflows_total', 1, {
                                status: 'completed',
                                steps: 4,
                                duration: 'long'
                            });

                            metrics.recordHistogram('workflow_total_duration_ms', 3000, {
                                workflow: 'complex_test',
                                steps: 4
                            });

                            tracing.endSpan();
                            updateStatus('‚úÖ Complex workflow completed!', 'success');
                            logActivity('Complex workflow completed successfully', 'success');
                            showAlert('Complex workflow completed successfully!', 'success');
                        }, 1000);
                    }, 1000);
                }, 500);
            }, 200);
        }

        // Performance metrics
        function refreshPerformanceMetrics() {
            if (!monitor) return;

            const mockMetrics = {
                fcp: Math.random() * 1500 + 300,
                lcp: Math.random() * 3000 + 800,
                fid: Math.random() * 100 + 10,
                cls: Math.random() * 0.3,
                ttfb: Math.random() * 500 + 100,
                domContentLoaded: Math.random() * 1000 + 200,
                loadComplete: Math.random() * 2000 + 500
            };

            // Update UI with animation
            Object.entries(mockMetrics).forEach(([key, value]) => {
                const element = document.getElementById(`metric-${key}`);
                if (element) {
                    const oldValue = element.textContent;
                    element.style.transform = 'scale(1.1)';
                    element.style.transition = 'transform 0.3s ease';

                    setTimeout(() => {
                        element.textContent = formatMetricValue(key, value);
                        element.style.transform = 'scale(1)';

                        // Update trend indicator
                        const trendElement = document.getElementById(`trend-${key}`);
                        if (trendElement) {
                            const trend = Math.random() > 0.5 ? 'improving' : 'declining';
                            trendElement.textContent = `${getMetricName(key)} - ${trend}`;
                            trendElement.className = `metric-trend ${trend === 'declining' ? 'down' : ''}`;
                        }
                    }, 150);
                }
            });

            // Record metrics
            monitor.recordMetrics(mockMetrics);
            updateStatus('üîÑ Performance metrics refreshed', 'info');
            logActivity('Performance metrics refreshed', 'info');
        }

        function formatMetricValue(key, value) {
            if (key === 'cls') {
                return value.toFixed(3);
            }
            return `${Math.round(value)}ms`;
        }

        function getMetricName(key) {
            const names = {
                fcp: 'First Contentful Paint',
                lcp: 'Largest Contentful Paint',
                fid: 'First Input Delay',
                cls: 'Cumulative Layout Shift',
                ttfb: 'Time to First Byte',
                domContentLoaded: 'DOM Content Loaded',
                loadComplete: 'Load Complete'
            };
            return names[key] || key;
        }

        // Custom metrics
        function addCustomMetric() {
            if (!monitor) return;

            const value = parseFloat(document.getElementById('metric-value').value) || 0;
            const label = document.getElementById('metric-label').value || 'custom';
            const type = document.getElementById('metric-type').value;

            const metrics = monitor.getMetricsCollector();

            switch (type) {
                case 'counter':
                    metrics.incrementCounter(`custom_counter_${label}`, value, {
                        user_id: currentUser?.id || 'anonymous',
                        category: 'user_defined'
                    });
                    break;
                case 'histogram':
                    metrics.recordHistogram(`custom_histogram_${label}`, value, {
                        user_id: currentUser?.id || 'anonymous',
                        category: 'user_defined'
                    });
                    break;
                case 'gauge':
                    metrics.recordGauge(`custom_gauge_${label}`, value, {
                        user_id: currentUser?.id || 'anonymous',
                        category: 'user_defined'
                    });
                    break;
            }

            // Add to local display
            const metricData = {
                id: Date.now().toString(),
                label,
                value,
                type,
                timestamp: Date.now()
            };

            customMetricsData.push(metricData);

            // Keep only last 20 metrics
            if (customMetricsData.length > 20) {
                customMetricsData = customMetricsData.slice(-20);
            }

            statistics.metrics++;
            updateStatistics();
            updateCustomMetricsDisplay();
            logActivity(`Custom metric added: ${label} (${type}) = ${value}`, 'success');

            // Reset form
            document.getElementById('metric-value').value = 100;
            document.getElementById('metric-label').value = 'user_engagement';
        }

        function incrementCounter() {
            if (!monitor) return;

            const label = document.getElementById('metric-label').value || 'click_counter';
            const value = parseInt(document.getElementById('metric-value').value) || 1;

            const metrics = monitor.getMetricsCollector();
            metrics.incrementCounter(`increment_counter_${label}`, value, {
                user_id: currentUser?.id || 'anonymous',
                trigger: 'manual_button'
            });

            statistics.metrics++;
            updateStatistics();
            logActivity(`Counter incremented: ${label} +${value}`, 'info');
        }

        function clearMetrics() {
            customMetricsData = [];
            updateCustomMetricsDisplay();
            logActivity('Custom metrics cleared', 'info');
        }

        function updateCustomMetricsDisplay() {
            const listElement = document.getElementById('custom-metrics-list');

            if (customMetricsData.length === 0) {
                listElement.innerHTML = `
                    <p style="text-align: center; color: #9ca3af;">
                        No custom metrics recorded yet
                    </p>
                `;
                return;
            }

            listElement.innerHTML = customMetricsData.map(metric => `
                <div class="metric-item">
                    <div class="metric-info">
                        <div class="metric-name">${metric.label}</div>
                        <div class="metric-type">${metric.type.toUpperCase()}</div>
                        <div style="font-size: 0.75rem; color: #6b7280; margin-top: 2px;">
                            ${new Date(metric.timestamp).toLocaleString()}
                        </div>
                    </div>
                    <div class="metric-value-display">
                        ${metric.value}
                        <div style="font-size: 0.75rem; color: #6b7280; margin-top: 2px;">
                            ${getMetricIcon(metric.type)}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getMetricIcon(type) {
            const icons = {
                counter: 'üî¢',
                histogram: 'üìä',
                gauge: 'üìà'
            };
            return icons[type] || 'üìè';
        }

        // Utility functions
        function generateId() {
            return Math.random().toString(36).substr(2, 9);
        }

        function generateSessionId() {
            return 'session_' + Date.now() + '_' + generateId();
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initializeMonitor);

        // Handle user interactions
        document.addEventListener('click', (event) => {
            const element = event.target;
            if (element.tagName === 'BUTTON') {
                const buttonText = element.textContent;
                logActivity(`Button clicked: ${buttonText}`, 'info');
            }
        });

        document.addEventListener('input', (event) => {
            const element = event.target;
            if (element.tagName === 'INPUT') {
                const hasValue = element.value.length > 0;
                logActivity(`Input changed: ${element.name || 'unnamed'} = ${hasValue ? 'has_value' : 'empty'}`, 'info');
            }
        });

        // Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                logActivity('Page became hidden', 'info');
            } else {
                logActivity('Page became visible', 'info');
            }
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (monitor) {
                const sessionDuration = Date.now() - sessionStartTime;

                const metrics = monitor.getMetricsCollector();
                metrics.recordHistogram('session_duration_ms', sessionDuration, {
                    reason: 'page_unload'
                });

                metrics.incrementCounter('page_sessions_total', 1, {
                    ended_gracefully: 'true'
                });

                logActivity('Page session ending', 'info');
                monitor.destroy();
            }
        });

        // Handle connection status
        window.addEventListener('online', () => {
            updateConnectionStatus('üü¢ Online');
            logActivity('Connection restored', 'info');
        });

        window.addEventListener('offline', () => {
            updateConnectionStatus('üî¥ Offline');
            logActivity('Connection lost', 'warning');
        });
    </script>
</body>
</html>