<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·¯ç”±ç›‘æ§ç¤ºä¾‹ - Frontend Monitor SDK</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            display: grid;
            gap: 20px;
        }
        .section {
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            background: #f8f9fa;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .log-area {
            background: #1e1e1e;
            color: #fff;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .route-info {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .config-section {
            background: #fff3cd;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #ffc107;
        }
        .demo-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ å‰ç«¯ç›‘æ§SDK - è·¯ç”±ç›‘æ§ç¤ºä¾‹</h1>

    <div class="container">
        <!-- é…ç½®è¯´æ˜ -->
        <div class="section config-section">
            <h3>âš™ï¸ è·¯ç”±ç›‘æ§é…ç½®</h3>
            <p>æ­¤ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å‰ç«¯ç›‘æ§SDKçš„è·¯ç”±ç›‘æ§åŠŸèƒ½ï¼š</p>
            <ul>
                <li>âœ… Hashè·¯ç”±ç›‘æ§ (<code>#/path</code>)</li>
                <li>âœ… History APIç›‘æ§ (<code>pushState/replaceState</code>)</li>
                <li>âœ… æµè§ˆå™¨å¯¼èˆªç›‘æ§ (<code>popstate</code>)</li>
                <li>âœ… è·¯ç”±å‚æ•°è§£æ</li>
                <li>âœ… æŸ¥è¯¢å‚æ•°è§£æ</li>
                <li>âœ… è·¯ç”±åˆ‡æ¢æ€§èƒ½ç»Ÿè®¡</li>
            </ul>
        </div>

        <!-- å½“å‰è·¯ç”±ä¿¡æ¯ -->
        <div class="section">
            <h3>ğŸ“ å½“å‰è·¯ç”±ä¿¡æ¯</h3>
            <div id="routeInfo" class="route-info">
                <div><strong>è·¯å¾„:</strong> <span id="currentPath">/</span></div>
                <div><strong>æŸ¥è¯¢å‚æ•°:</strong> <span id="currentQuery">{}</span></div>
                <div><strong>è·¯ç”±å‚æ•°:</strong> <span id="currentParams">{}</span></div>
            </div>
        </div>

        <!-- æ¼”ç¤ºæŒ‰é’® -->
        <div class="section">
            <h3>ğŸ® è·¯ç”±æ“ä½œæ¼”ç¤º</h3>
            <div class="demo-section">
                <div>
                    <h4>Hashè·¯ç”±æµ‹è¯•</h4>
                    <button class="btn" onclick="navigateHash('/home')">#/home</button>
                    <button class="btn" onclick="navigateHash('/users/123')">#/users/123</button>
                    <button class="btn" onclick="navigateHash('/search?q=test')">#/search?q=test</button>
                </div>

                <div>
                    <h4>History APIæµ‹è¯•</h4>
                    <button class="btn" onclick="pushHistory('/dashboard')">/dashboard</button>
                    <button class="btn" onclick="pushHistory('/products/456')">/products/456</button>
                    <button class="btn" onclick="replaceHistory('/settings')">/settings</button>
                </div>

                <div>
                    <h4>æµè§ˆå™¨å¯¼èˆª</h4>
                    <button class="btn" onclick="goBack()">â† åé€€</button>
                    <button class="btn" onclick="goForward()">â†’ å‰è¿›</button>
                    <button class="btn" onclick="externalNavigation()">å¤–éƒ¨é“¾æ¥</button>
                </div>
            </div>
        </div>

        <!-- è·¯ç”±å˜åŒ–æ—¥å¿— -->
        <div class="section">
            <h3>ğŸ“Š è·¯ç”±å˜åŒ–æ—¥å¿—</h3>
            <button class="btn" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
            <div id="routeLog" class="log-area">
                ç­‰å¾…è·¯ç”±å˜åŒ–äº‹ä»¶...\n
            </div>
        </div>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="section">
            <h3>ğŸ“ˆ è·¯ç”±ç»Ÿè®¡</h3>
            <div id="routeStats">
                <div>ğŸ”„ æ€»è·¯ç”±å˜åŒ–: <span id="totalChanges">0</span></div>
                <div>âš¡ å¹³å‡åˆ‡æ¢æ—¶é—´: <span id="avgDuration">0ms</span></div>
                <div>ğŸ¯ Hashè·¯ç”±: <span id="hashCount">0</span></div>
                <div>ğŸ“œ History API: <span id="historyCount">0</span></div>
                <div>â†©ï¸ Popstate: <span id="popstateCount">0</span></div>
            </div>
        </div>
    </div>

    <script type="module">
        // åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥æ˜¯ä» npm åŒ…å¯¼å…¥
        // import { createFrontendMonitor } from '@your-org/frontend-monitor-sdk';

        // ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬æ¨¡æ‹ŸSDKæ¥å£
        console.log('ğŸš€ åˆå§‹åŒ–å‰ç«¯ç›‘æ§SDK...');

        // è·¯ç”±å˜åŒ–ç»Ÿè®¡
        const stats = {
            totalChanges: 0,
            totalDuration: 0,
            hashCount: 0,
            historyCount: 0,
            popstateCount: 0,
            loadCount: 0
        };

        // æ—¥å¿—å‡½æ•°
        function log(message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('routeLog');
            const logEntry = `[${timestamp}] ${message}\n`;
            logElement.textContent += logEntry;

            if (data) {
                logElement.textContent += `  æ•°æ®: ${JSON.stringify(data, null, 2)}\n`;
            }

            logElement.textContent += '\n';
            logElement.scrollTop = logElement.scrollHeight;
        }

        // æ›´æ–°å½“å‰è·¯ç”±ä¿¡æ¯
        function updateRouteInfo() {
            const path = window.location.pathname + window.location.search + window.location.hash;
            const query = Object.fromEntries(new URLSearchParams(window.location.search));

            document.getElementById('currentPath').textContent = path;
            document.getElementById('currentQuery').textContent = JSON.stringify(query);
            document.getElementById('currentParams').textContent = '{}'; // ç®€åŒ–ç¤ºä¾‹
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            document.getElementById('totalChanges').textContent = stats.totalChanges;
            document.getElementById('hashCount').textContent = stats.hashCount;
            document.getElementById('historyCount').textContent = stats.historyCount;
            document.getElementById('popstateCount').textContent = stats.popstateCount;

            const avgDuration = stats.totalChanges > 0
                ? Math.round(stats.totalDuration / stats.totalChanges)
                : 0;
            document.getElementById('avgDuration').textContent = `${avgDuration}ms`;
        }

        // æ¨¡æ‹Ÿè·¯ç”±ç›‘æ§å›è°ƒ
        function handleRouteChange(event) {
            log(`ğŸ”„ è·¯ç”±å˜åŒ–: ${event.type}`, {
                from: event.from,
                to: event.to,
                duration: event.duration,
                isSPA: event.isSPA,
                params: event.params,
                query: event.query
            });

            // æ›´æ–°ç»Ÿè®¡
            stats.totalChanges++;
            if (event.duration) {
                stats.totalDuration += event.duration;
            }

            switch (event.type) {
                case 'hash':
                    stats.hashCount++;
                    break;
                case 'pushstate':
                case 'replacestate':
                    stats.historyCount++;
                    break;
                case 'popstate':
                    stats.popstateCount++;
                    break;
                case 'load':
                    stats.loadCount++;
                    break;
            }

            updateStats();
            updateRouteInfo();
        }

        // è·¯ç”±å¯¼èˆªå‡½æ•°
        window.navigateHash = function(path) {
            log(`ğŸ¯ å¯¼èˆªåˆ°Hashè·¯ç”±: ${path}`);
            window.location.hash = path;

            // æ¨¡æ‹Ÿè·¯ç”±å˜åŒ–äº‹ä»¶
            setTimeout(() => {
                handleRouteChange({
                    type: 'hash',
                    from: window.location.pathname,
                    to: window.location.pathname + window.location.search + window.location.hash,
                    timestamp: Date.now(),
                    isSPA: true,
                    duration: Math.random() * 50 + 10, // æ¨¡æ‹Ÿè·¯ç”±åˆ‡æ¢æ—¶é—´
                    query: {},
                    params: {}
                });
            }, 0);
        };

        window.pushHistory = function(path) {
            log(`ğŸ“œ ä½¿ç”¨History API pushState: ${path}`);
            const state = { path, timestamp: Date.now() };
            history.pushState(state, '', path);

            // æ¨¡æ‹Ÿè·¯ç”±å˜åŒ–äº‹ä»¶
            setTimeout(() => {
                handleRouteChange({
                    type: 'pushstate',
                    from: window.location.pathname,
                    to: path,
                    timestamp: Date.now(),
                    isSPA: true,
                    duration: Math.random() * 80 + 20,
                    query: {},
                    params: {},
                    state
                });
            }, 0);
        };

        window.replaceHistory = function(path) {
            log(`ğŸ“ ä½¿ç”¨History API replaceState: ${path}`);
            const state = { path, timestamp: Date.now() };
            history.replaceState(state, '', path);

            // æ¨¡æ‹Ÿè·¯ç”±å˜åŒ–äº‹ä»¶
            setTimeout(() => {
                handleRouteChange({
                    type: 'replacestate',
                    from: window.location.pathname,
                    to: path,
                    timestamp: Date.now(),
                    isSPA: true,
                    duration: Math.random() * 60 + 15,
                    query: {},
                    params: {},
                    state
                });
            }, 0);
        };

        window.goBack = function() {
            log('â¬…ï¸ æµè§ˆå™¨åé€€');
            history.back();

            // æ¨¡æ‹Ÿpopstateäº‹ä»¶
            setTimeout(() => {
                handleRouteChange({
                    type: 'popstate',
                    from: '/unknown',
                    to: window.location.pathname,
                    timestamp: Date.now(),
                    isSPA: true,
                    duration: Math.random() * 30 + 5,
                    query: {},
                    params: {}
                });
            }, 100);
        };

        window.goForward = function() {
            log('â¡ï¸ æµè§ˆå™¨å‰è¿›');
            history.forward();

            setTimeout(() => {
                handleRouteChange({
                    type: 'popstate',
                    from: '/unknown',
                    to: window.location.pathname,
                    timestamp: Date.now(),
                    isSPA: true,
                    duration: Math.random() * 30 + 5,
                    query: {},
                    params: {}
                });
            }, 100);
        };

        window.externalNavigation = function() {
            log('ğŸŒ å¤–éƒ¨å¯¼èˆª (å°†ç¦»å¼€å½“å‰é¡µé¢)');
            setTimeout(() => {
                window.location.href = 'https://example.com';
            }, 2000);
        };

        window.clearLog = function() {
            document.getElementById('routeLog').textContent = 'æ—¥å¿—å·²æ¸…ç©º\n\n';
        };

        // æ¨¡æ‹ŸSDKåˆå§‹åŒ–
        function initializeSDK() {
            log('ğŸš€ æ¨¡æ‹ŸSDKåˆå§‹åŒ–å¼€å§‹...');

            // æ¨¡æ‹Ÿåˆå§‹åŒ–è¿‡ç¨‹
            setTimeout(() => {
                log('âœ… SDKåˆå§‹åŒ–å®Œæˆ', {
                    serviceName: 'route-monitoring-demo',
                    endpoint: 'https://collector.example.com',
                    enableRouteMonitoring: true,
                    routeMonitoringConfig: {
                        hashRouting: true,
                        historyAPI: true,
                        popstate: true,
                        parseParams: true,
                        parseQuery: true
                    }
                });

                // è®°å½•é¡µé¢åŠ è½½è·¯ç”±
                handleRouteChange({
                    type: 'load',
                    from: '',
                    to: window.location.pathname + window.location.search + window.location.hash,
                    timestamp: Date.now(),
                    isSPA: false,
                    title: document.title
                });

                updateRouteInfo();
            }, 1000);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializeSDK);

        // ç›‘å¬å®é™…çš„æµè§ˆå™¨äº‹ä»¶ï¼ˆçœŸå®ç¯å¢ƒä¸­çš„è¡Œä¸ºï¼‰
        window.addEventListener('hashchange', () => {
            log('ğŸ”— å®é™…hashchangeäº‹ä»¶è§¦å‘');
            updateRouteInfo();
        });

        window.addEventListener('popstate', (event) => {
            log('ğŸ“ å®é™…popstateäº‹ä»¶è§¦å‘', { state: event.state });
            updateRouteInfo();
        });
    </script>
</body>
</html>